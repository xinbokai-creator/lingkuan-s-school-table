<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½ çš„å°ˆå±¬é¸èª²æ¨¡æ“¬å™¨</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --border-color: #ddd;
            --occupied-color: #e0e0e0;
            --fixed-course-color: #ffecd1; /* å¿…ä¿®èª²é¡è‰² */
            --pe-course-color: #d1f7c4; /* é«”è‚²èª²é¡è‰² */
            --ge-course-color: #d1e8ff; /* é€šè­˜èª²é¡è‰² */
        }

        body {
            font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        h1 { text-align: center; grid-column: 1 / -1; color: #2c3e50; }
        
        /* é¸èª²å€å¡Šæ¨£å¼ */
        .selection-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-height: 800px;
            overflow-y: auto;
        }

        .course-group h3 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            margin-top: 20px;
        }

        .course-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .course-item:hover { background-color: #f9f9f9; }
        .course-item.selected { border-color: var(--primary-color); background-color: #eaf4ff; }
        .course-item.disabled { opacity: 0.5; cursor: not-allowed; background-color: #eee; }

        .course-info { margin-left: 10px; flex: 1; }
        .course-time { font-size: 0.85em; color: #666; }
        .course-name { font-weight: bold; }

        /* èª²è¡¨æ¨£å¼ */
        .schedule-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: center;
            vertical-align: middle;
            height: 50px;
            font-size: 0.9em;
        }

        th { background-color: var(--primary-color); color: white; }
        .time-col { width: 80px; background-color: #f8f9fa; font-weight: bold; }

        /* èª²ç¨‹æ ¼å­é¡è‰² */
        .cell-fixed { background-color: var(--fixed-course-color); border-left: 4px solid #ffa500; }
        .cell-pe { background-color: var(--pe-course-color); border-left: 4px solid #28a745; }
        .cell-ge { background-color: var(--ge-course-color); border-left: 4px solid #007bff; }

        .conflict-alert {
            color: red;
            font-weight: bold;
            margin-top: 10px;
            min-height: 20px;
        }
        
        button#reset-btn {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button#reset-btn:hover { background-color: #c0392b; }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <h1>ğŸ“… 2026 æ¨¡æ“¬é¸èª²ç³»çµ±</h1>

    <div class="container">
        <!-- å·¦å´ï¼šé¸èª²æ¸…å–® -->
        <div class="selection-panel">
            <div id="conflict-msg" class="conflict-alert"></div>
            
            <div class="course-group">
                <h3>ğŸ¸ 1. é«”è‚²èª² (å¿…ä¿® 1.0)</h3>
                <div id="pe-courses"></div>
            </div>

            <div class="course-group">
                <h3>ğŸ“ 2. é€šè­˜èª² (é¸ä¿® 2.0)</h3>
                <div id="ge-courses"></div>
            </div>
            
            <button id="reset-btn" onclick="resetSelection()">é‡ç½®æ‰€æœ‰é¸æ“‡</button>
        </div>

        <!-- å³å´ï¼šèª²è¡¨ -->
        <div class="schedule-panel">
            <table id="schedule-table">
                <thead>
                    <tr>
                        <th class="time-col">ç¯€æ¬¡</th>
                        <th>é€±ä¸€</th>
                        <th>é€±äºŒ</th>
                        <th>é€±ä¸‰</th>
                        <th>é€±å››</th>
                        <th>é€±äº”</th>
                    </tr>
                </thead>
                <tbody id="schedule-body">
                    <!-- Javascript å°‡è‡ªå‹•ç”Ÿæˆé€™è£¡ -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // åŸºç¤è³‡æ–™è¨­å®š
        const times = [
            { id: 1, name: "01-02", label: "08:10-10:00" },
            { id: 2, name: "03-04", label: "10:10-12:00" },
            { id: 3, name: "ä¸­åˆ", label: "12:00-13:30" }, // é›–ç„¶æ²’èª²ï¼Œä½†ç•™è‘—åšåˆ†éš”
            { id: 4, name: "06-07", label: "13:30-15:20" },
            { id: 5, name: "08-09", label: "15:30-17:20" }
        ];

        // æ—¢å®šå¿…ä¿®èª² (æ ¼å¼: day 1-5, slot 1=01-02, 2=03-04, 4=06-07, 5=08-09)
        const fixedCourses = [
            { day: 1, slot: 2, name: "è²éŸ»å­¸", code: "CH331" },
            { day: 1, slot: 4, name: "ä¿®è¾­å­¸", code: "CH332" },
            { day: 2, slot: 2, name: "æ‡‰ç”¨æ–‡", code: "CH337" },
            { day: 3, slot: 1, name: "æ•™ææ•™æ³•", code: "CH306" },
            { day: 3, slot: 5, name: "è©é¸åŠç¿’ä½œ", code: "CH339" },
            { day: 4, slot: 2, name: "å­¸åº¸", code: "CH333" },
            { day: 4, slot: 4, name: "æ•™å­¸å¯¦ç¿’", code: "CH302" },
            { day: 4, slot: 5, name: "ç­ç´šç®¡ç†", code: "CH303" }
        ];

        // é«”è‚²èª²é¸é …
        const peOptions = [
            { id: "GR208", name: "æ’çƒçµ„ (å¼µæ™ºæƒ )", day: 2, slot: 4 },
            { id: "GR209", name: "æ¡Œçƒçµ„ (é»ƒç¾ç)", day: 2, slot: 4 },
            { id: "GR210", name: "æ¥µé™é£›è¼ª (æ—æ€¡å¦‚)", day: 2, slot: 5 },
            { id: "GR211", name: "é«”é©èƒ½ (è¬å‹»è“)", day: 2, slot: 5 },
            { id: "GR212", name: "æ¡Œçƒçµ„ (é»ƒç¾ç)", day: 3, slot: 2 },
            { id: "GR221", name: "æ’çƒçµ„ (éƒ­ç¾èŠ¬)", day: 5, slot: 1 },
            { id: "GR222", name: "é«”é©èƒ½ (è¬æµ·å–¬)", day: 5, slot: 1 },
            { id: "GR223", name: "æ’çƒçµ„ (éƒ­ç¾èŠ¬)", day: 5, slot: 2 },
            { id: "GR224", name: "ç¶²çƒçµ„ (å³ç›Šå‹)", day: 5, slot: 5 },
            { id: "GR225", name: "ç¾½çƒçµ„ (æ´ªåœ‹æ¬½)", day: 5, slot: 5 },
            { id: "GR226", name: "é£›ç›¤ (è”¡æ™‰ç‘‹)", day: 5, slot: 5 },
            { id: "GR227", name: "ç‘œçˆ (å¼µé‡‘éƒ)", day: 5, slot: 5 },
            { id: "GR228", name: "é«”é©èƒ½ (æ—å­ç¿”)", day: 5, slot: 5 },
            { id: "GR229", name: "é‡é‡è¨“ç·´ (èƒ¡å®¶è“)", day: 5, slot: 5 }
        ];

        // é€šè­˜èª²é¸é …
        const geOptions = [
            { id: "GR801", name: "ç¤¾æœƒå­¸å‹•å‹•è…¦", day: 2, slot: 4 },
            { id: "GR802", name: "é£²é£Ÿå¿ƒç†", day: 2, slot: 4 },
            { id: "GR803", name: "å…¨çƒè®Šé·èˆ‡æ°¸çºŒç™¼å±•", day: 2, slot: 4 },
            { id: "GR808", name: "è·¨æ–‡åŒ–æºé€š-ç”Ÿæ´»æ—¥èª", day: 2, slot: 4 },
            { id: "GR809", name: "æ‰‹æ©Ÿæ”å½±", day: 2, slot: 4 },
            { id: "GR812", name: "ç¸«ç´‰èˆ‡æ‰‹ä½œ", day: 2, slot: 4 },
            { id: "GR813", name: "æœ¨å·¥å¯¦ä½œ", day: 2, slot: 4 },
            { id: "GR816", name: "é™¶è—å¯¦ä½œ", day: 2, slot: 4 },
            { id: "GR815", name: "æ–™ç†èˆ‡ç§‘å­¸", day: 2, slot: 5 },
            { id: "GR817", name: "é™¶è—å¯¦ä½œ", day: 2, slot: 5 },
            { id: "GR818", name: "é«˜æ·èˆ‡è¼•è»Œæ–‡å‰µ", day: 2, slot: 5 },
            { id: "GR811", name: "ç¸«ç´‰èˆ‡æ‰‹ä½œ", day: 3, slot: 2 },
            { id: "GR834", name: "é›»å½±è—è¡“è³æ", day: 5, slot: 2 },
            { id: "GR839", name: "çƒå…‹éº—éº—", day: 5, slot: 2 },
            { id: "GR841", name: "åœ’è—æ²»ç™‚", day: 5, slot: 2 },
            { id: "GR828", name: "ç”Ÿæ´»éŸ“èª", day: 5, slot: 2 },
            { id: "GR844", name: "å¤šå…ƒåª’æå·¥è—", day: 5, slot: 2 },
            { id: "GR845", name: "ç¸«ç´‰èˆ‡æ‰‹ä½œ (3å­¸åˆ†)", day: 5, slot: 2, note: "è·¨åˆ°ç¬¬5ç¯€" } // ç°¡åŒ–é¡¯ç¤º
        ];

        let selectedCourses = []; // å„²å­˜ç”¨æˆ¶é¸æ“‡çš„èª²ç¨‹ ID

        function init() {
            renderSchedule();
            renderSelectionList();
        }

        // æ¸²æŸ“èª²è¡¨
        function renderSchedule() {
            const tbody = document.getElementById("schedule-body");
            tbody.innerHTML = "";

            times.forEach(time => {
                const tr = document.createElement("tr");
                
                // æ™‚é–“æ¬„ä½
                const tdTime = document.createElement("td");
                tdTime.className = "time-col";
                tdTime.innerHTML = `<strong>${time.name}</strong><br><span style='font-size:0.7em'>${time.label}</span>`;
                tr.appendChild(tdTime);

                // é€±ä¸€åˆ°é€±äº”
                for (let day = 1; day <= 5; day++) {
                    const td = document.createElement("td");
                    
                    // 1. æª¢æŸ¥å¿…ä¿®èª²
                    const fixed = fixedCourses.find(c => c.day === day && c.slot === time.id);
                    if (fixed) {
                        td.innerHTML = `<strong>${fixed.name}</strong><br>${fixed.code}`;
                        td.className = "cell-fixed";
                    }

                    // 2. æª¢æŸ¥ç”¨æˆ¶é¸çš„é«”è‚²èª²
                    const userPe = peOptions.find(c => selectedCourses.includes(c.id) && c.day === day && c.slot === time.id);
                    if (userPe) {
                        td.innerHTML = `<strong>${userPe.name}</strong><br>${userPe.id}`;
                        td.className = "cell-pe";
                    }

                    // 3. æª¢æŸ¥ç”¨æˆ¶é¸çš„é€šè­˜èª²
                    const userGe = geOptions.find(c => selectedCourses.includes(c.id) && c.day === day && c.slot === time.id);
                    if (userGe) {
                        td.innerHTML = `<strong>${userGe.name}</strong><br>${userGe.id}`;
                        td.className = "cell-ge";
                    }
                    
                    // ç‰¹åˆ¥è™•ç†ï¼šä¸­åˆæ™‚æ®µ
                    if(time.id === 3) {
                        td.style.backgroundColor = "#eee";
                        td.innerHTML = "-";
                    }

                    tr.appendChild(td);
                }
                tbody.appendChild(tr);
            });
        }

        // æ¸²æŸ“é¸èª²æ¸…å–®
        function renderSelectionList() {
            const peContainer = document.getElementById("pe-courses");
            const geContainer = document.getElementById("ge-courses");
            
            peContainer.innerHTML = createCourseListHTML(peOptions, "pe");
            geContainer.innerHTML = createCourseListHTML(geOptions, "ge");

            updateCourseStatus();
        }

        function createCourseListHTML(courses, type) {
            return courses.map(course => {
                const timeStr = `é€±${["","ä¸€","äºŒ","ä¸‰","å››","äº”"][course.day]} ${times.find(t=>t.id===course.slot).name}`;
                return `
                    <div class="course-item" id="course-${course.id}" onclick="toggleCourse('${course.id}', '${type}', ${course.day}, ${course.slot})">
                        <input type="checkbox" ${selectedCourses.includes(course.id) ? "checked" : ""}>
                        <div class="course-info">
                            <div class="course-name">${course.id} ${course.name}</div>
                            <div class="course-time">${timeStr}</div>
                        </div>
                    </div>
                `;
            }).join("");
        }

        // åˆ‡æ›èª²ç¨‹é¸æ“‡ç‹€æ…‹
        function toggleCourse(courseId, type, day, slot) {
            const msg = document.getElementById("conflict-msg");
            msg.innerText = "";

            // å¦‚æœå·²ç¶“é¸äº†ï¼Œå–æ¶ˆé¸æ“‡
            if (selectedCourses.includes(courseId)) {
                selectedCourses = selectedCourses.filter(id => id !== courseId);
            } else {
                // æª¢æŸ¥è¡å ‚
                // 1. æª¢æŸ¥æ˜¯å¦èˆ‡å¿…ä¿®è¡çª (é›–ç„¶è³‡æ–™å·²ç¶“æ’é™¤ï¼Œä½†ç‚ºäº†é‚è¼¯å®Œæ•´æ€§)
                const isFixedConflict = fixedCourses.some(c => c.day === day && c.slot === slot);
                if (isFixedConflict) {
                    msg.innerText = "âŒ æ­¤æ™‚æ®µå·²æœ‰å¿…ä¿®èª²ï¼Œç„¡æ³•åŠ é¸ï¼";
                    return;
                }

                // 2. æª¢æŸ¥æ˜¯å¦èˆ‡å·²é¸çš„å…¶ä»–èª²ç¨‹è¡çª
                const allOptions = [...peOptions, ...geOptions];
                const conflictId = selectedCourses.find(id => {
                    const c = allOptions.find(opt => opt.id === id);
                    return c.day === day && c.slot === slot;
                });

                if (conflictId) {
                    msg.innerText = `âŒ æ™‚é–“è¡çªï¼è«‹å…ˆé€€é¸åŒæ™‚ä»£çš„èª²ç¨‹ (${conflictId})`;
                    return;
                }
                
                // é™åˆ¶ï¼šé«”è‚²åªèƒ½é¸ä¸€é–€ï¼Œé€šè­˜åªèƒ½é¸ä¸€é–€ (ä¾ä½ çš„éœ€æ±‚æ¨¡æ“¬)
                // é€™è£¡å…ˆä¸åšç¡¬æ€§é™åˆ¶ï¼Œè®“ä½ è‡ªç”±æ’ï¼Œä½†ä½ å¯ä»¥è‡ªè¡Œæ±ºå®šè¦ä¸è¦å¤šé¸
                
                selectedCourses.push(courseId);
            }

            renderSchedule();
            updateCourseStatus();
        }

        // æ›´æ–°æ¸…å–®æ¨£å¼ï¼ˆå·²é¸é«˜äº®ã€è¡çªè®Šç°ï¼‰
        function updateCourseStatus() {
            const allOptions = [...peOptions, ...geOptions];
            
            allOptions.forEach(course => {
                const el = document.getElementById(`course-${course.id}`);
                if(!el) return;

                const isSelected = selectedCourses.includes(course.id);
                
                // æª¢æŸ¥æ˜¯å¦è¢«å…¶ä»–å·²é¸èª²ç¨‹æ“‹ä½
                const isBlocked = selectedCourses.some(id => {
                    if (id === course.id) return false;
                    const selectedC = allOptions.find(c => c.id === id);
                    return selectedC.day === course.day && selectedC.slot === course.slot;
                });

                el.classList.remove("selected", "disabled");
                if (isSelected) {
                    el.classList.add("selected");
                    el.querySelector("input").checked = true;
                } else {
                    el.querySelector("input").checked = false;
                    if (isBlocked) {
                        el.classList.add("disabled");
                    }
                }
            });
        }

        function resetSelection() {
            selectedCourses = [];
            renderSchedule();
            updateCourseStatus();
            document.getElementById("conflict-msg").innerText = "";
        }

        // å•Ÿå‹•
        init();
    </script>
</body>
</html>
